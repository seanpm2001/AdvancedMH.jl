<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>AdvancedMH.jl · AdvancedMH</title><meta name="title" content="AdvancedMH.jl · AdvancedMH"/><meta property="og:title" content="AdvancedMH.jl · AdvancedMH"/><meta property="twitter:title" content="AdvancedMH.jl · AdvancedMH"/><meta name="description" content="Documentation for AdvancedMH."/><meta property="og:description" content="Documentation for AdvancedMH."/><meta property="twitter:description" content="Documentation for AdvancedMH."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>AdvancedMH</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>AdvancedMH.jl</a><ul class="internal"><li><a class="tocitem" href="#Usage"><span>Usage</span></a></li><li><a class="tocitem" href="#Proposals"><span>Proposals</span></a></li><li><a class="tocitem" href="#Static-vs.-Random-Walk"><span>Static vs. Random Walk</span></a></li><li><a class="tocitem" href="#Multiple-chains"><span>Multiple chains</span></a></li><li><a class="tocitem" href="#Metropolis-adjusted-Langevin-algorithm-(MALA)"><span>Metropolis-adjusted Langevin algorithm (MALA)</span></a></li></ul></li><li><a class="tocitem" href="api/">AdvancedMH.jl</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>AdvancedMH.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>AdvancedMH.jl</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/TuringLang/AdvancedMH.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/TuringLang/AdvancedMH.jl/blob/master/README.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="AdvancedMH.jl"><a class="docs-heading-anchor" href="#AdvancedMH.jl">AdvancedMH.jl</a><a id="AdvancedMH.jl-1"></a><a class="docs-heading-anchor-permalink" href="#AdvancedMH.jl" title="Permalink"></a></h1><p><a href="https://turinglang.github.io/AdvancedMH.jl/stable"><img src="https://img.shields.io/badge/docs-stable-blue.svg" alt="Stable"/></a> <a href="https://turinglang.github.io/AdvancedMH.jl/dev"><img src="https://img.shields.io/badge/docs-dev-blue.svg" alt="Dev"/></a> <a href="https://github.com/TuringLang/AdvancedMH.jl/actions/workflows/main.yml?query=branch%3Amaster"><img src="https://github.com/TuringLang/AdvancedMH.jl/actions/workflows/main.yml/badge.svg?branch=master" alt="AdvancedMH-CI"/></a></p><p>AdvancedMH.jl currently provides a robust implementation of random walk Metropolis-Hastings samplers.</p><p>Further development aims to provide a suite of adaptive Metropolis-Hastings implementations.</p><p>AdvancedMH works by allowing users to define composable <code>Proposal</code> structs in different formats.</p><h2 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h2><p>First, construct a <code>DensityModel</code>, which is a wrapper around the log density function for your inference problem. The <code>DensityModel</code> is then used in a <code>sample</code> call.</p><pre><code class="language-julia hljs"># Import the package.
using AdvancedMH
using Distributions
using MCMCChains

using LinearAlgebra

# Generate a set of data from the posterior we want to estimate.
data = rand(Normal(0, 1), 30)

# Define the components of a basic model.
insupport(θ) = θ[2] &gt;= 0
dist(θ) = Normal(θ[1], θ[2])
density(θ) = insupport(θ) ? sum(logpdf.(dist(θ), data)) : -Inf

# Construct a DensityModel.
model = DensityModel(density)

# Set up our sampler with a joint multivariate Normal proposal.
spl = RWMH(MvNormal(zeros(2), I))

# Sample from the posterior.
chain = sample(model, spl, 100000; param_names=[&quot;μ&quot;, &quot;σ&quot;], chain_type=Chains)</code></pre><p>Output:</p><pre><code class="language-julia hljs">Object of type Chains, with data of type 100000×3×1 Array{Float64,3}

Iterations        = 1:100000
Thinning interval = 1
Chains            = 1
Samples per chain = 100000
internals         = lp
parameters        = μ, σ

2-element Array{ChainDataFrame,1}

Summary Statistics

│ Row │ parameters │ mean     │ std      │ naive_se    │ mcse       │ ess     │ r_hat   │
│     │ Symbol     │ Float64  │ Float64  │ Float64     │ Float64    │ Any     │ Any     │
├─────┼────────────┼──────────┼──────────┼─────────────┼────────────┼─────────┼─────────┤
│ 1   │ μ          │ 0.156152 │ 0.19963  │ 0.000631285 │ 0.00323033 │ 3911.73 │ 1.00009 │
│ 2   │ σ          │ 1.07493  │ 0.150111 │ 0.000474693 │ 0.00240317 │ 3707.73 │ 1.00027 │

Quantiles

│ Row │ parameters │ 2.5%     │ 25.0%     │ 50.0%    │ 75.0%    │ 97.5%    │
│     │ Symbol     │ Float64  │ Float64   │ Float64  │ Float64  │ Float64  │
├─────┼────────────┼──────────┼───────────┼──────────┼──────────┼──────────┤
│ 1   │ μ          │ -0.23361 │ 0.0297006 │ 0.159139 │ 0.283493 │ 0.558694 │
│ 2   │ σ          │ 0.828288 │ 0.972682  │ 1.05804  │ 1.16155  │ 1.41349  │
</code></pre><h3 id="Usage-with-[LogDensityProblems.jl](https://github.com/tpapp/LogDensityProblems.jl)"><a class="docs-heading-anchor" href="#Usage-with-[LogDensityProblems.jl](https://github.com/tpapp/LogDensityProblems.jl)">Usage with <a href="https://github.com/tpapp/LogDensityProblems.jl"><code>LogDensityProblems.jl</code></a></a><a id="Usage-with-[LogDensityProblems.jl](https://github.com/tpapp/LogDensityProblems.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-with-[LogDensityProblems.jl](https://github.com/tpapp/LogDensityProblems.jl)" title="Permalink"></a></h3><p>Alternatively, you can define your model with the <a href="https://github.com/tpapp/LogDensityProblems.jl"><code>LogDensityProblems.jl</code></a> interface:</p><pre><code class="language-julia hljs">using LogDensityProblems

# Use a struct instead of `typeof(density)` for sake of readability.
struct LogTargetDensity end

LogDensityProblems.logdensity(p::LogTargetDensity, θ) = density(θ)  # standard multivariate normal
LogDensityProblems.dimension(p::LogTargetDensity) = 2
LogDensityProblems.capabilities(::LogTargetDensity) = LogDensityProblems.LogDensityOrder{0}()

sample(LogTargetDensity(), spl, 100000; param_names=[&quot;μ&quot;, &quot;σ&quot;], chain_type=Chains)</code></pre><h2 id="Proposals"><a class="docs-heading-anchor" href="#Proposals">Proposals</a><a id="Proposals-1"></a><a class="docs-heading-anchor-permalink" href="#Proposals" title="Permalink"></a></h2><p>AdvancedMH offers various methods of defining your inference problem. Behind the scenes, a <code>MetropolisHastings</code> sampler simply holds some set of <code>Proposal</code> structs. AdvancedMH will return posterior samples in the &quot;shape&quot; of the proposal provided – currently supported methods are <code>Array{Proposal}</code>, <code>Proposal</code>, and <code>NamedTuple{Proposal}</code>. For example, proposals can be created as:</p><pre><code class="language-julia hljs"># Provide a univariate proposal.
m1 = DensityModel(x -&gt; logpdf(Normal(x,1), 1.0))
p1 = StaticProposal(Normal(0,1))
c1 = sample(m1, MetropolisHastings(p1), 100; chain_type=Vector{NamedTuple})

# Draw from a vector of distributions.
m2 = DensityModel(x -&gt; logpdf(Normal(x[1], x[2]), 1.0))
p2 = StaticProposal([Normal(0,1), InverseGamma(2,3)])
c2 = sample(m2, MetropolisHastings(p2), 100; chain_type=Vector{NamedTuple})

# Draw from a `NamedTuple` of distributions.
m3 = DensityModel(x -&gt; logpdf(Normal(x.a, x.b), 1.0))
p3 = (a=StaticProposal(Normal(0,1)), b=StaticProposal(InverseGamma(2,3)))
c3 = sample(m3, MetropolisHastings(p3), 100; chain_type=Vector{NamedTuple})

# Draw from a functional proposal.
m4 = DensityModel(x -&gt; logpdf(Normal(x,1), 1.0))
p4 = StaticProposal((x=1.0) -&gt; Normal(x, 1))
c4 = sample(m4, MetropolisHastings(p4), 100; chain_type=Vector{NamedTuple})</code></pre><h2 id="Static-vs.-Random-Walk"><a class="docs-heading-anchor" href="#Static-vs.-Random-Walk">Static vs. Random Walk</a><a id="Static-vs.-Random-Walk-1"></a><a class="docs-heading-anchor-permalink" href="#Static-vs.-Random-Walk" title="Permalink"></a></h2><p>Currently there are only two methods of inference available. Static MH simply draws from the prior, with no conditioning on the previous sample. Random walk will add the proposal to the previously observed value. If you are constructing a <code>Proposal</code> by hand, you can determine whether the proposal is a <code>StaticProposal</code> or a <code>RandomWalkProposal</code> using</p><pre><code class="language-julia hljs">static_prop = StaticProposal(Normal(0,1))
rw_prop = RandomWalkProposal(Normal(0,1))</code></pre><p>Different methods are easily composeable. One parameter can be static and another can be a random walk, each of which may be drawn from separate distributions.</p><h2 id="Multiple-chains"><a class="docs-heading-anchor" href="#Multiple-chains">Multiple chains</a><a id="Multiple-chains-1"></a><a class="docs-heading-anchor-permalink" href="#Multiple-chains" title="Permalink"></a></h2><p>AdvancedMH.jl implements the interface of <a href="https://github.com/TuringLang/AbstractMCMC.jl/">AbstractMCMC</a> which means sampling of multiple chains is supported for free:</p><pre><code class="language-julia hljs"># Sample 4 chains from the posterior serially, without thread or process parallelism.
chain = sample(model, RWMH(init_params), MCMCSerial(), 100000, 4; param_names=[&quot;μ&quot;,&quot;σ&quot;], chain_type=Chains)

# Sample 4 chains from the posterior using multiple threads.
chain = sample(model, RWMH(init_params), MCMCThreads(), 100000, 4; param_names=[&quot;μ&quot;,&quot;σ&quot;], chain_type=Chains)

# Sample 4 chains from the posterior using multiple processes.
chain = sample(model, RWMH(init_params), MCMCDistributed(), 100000, 4; param_names=[&quot;μ&quot;,&quot;σ&quot;], chain_type=Chains)</code></pre><h2 id="Metropolis-adjusted-Langevin-algorithm-(MALA)"><a class="docs-heading-anchor" href="#Metropolis-adjusted-Langevin-algorithm-(MALA)">Metropolis-adjusted Langevin algorithm (MALA)</a><a id="Metropolis-adjusted-Langevin-algorithm-(MALA)-1"></a><a class="docs-heading-anchor-permalink" href="#Metropolis-adjusted-Langevin-algorithm-(MALA)" title="Permalink"></a></h2><p>AdvancedMH.jl also offers an implementation of <a href="https://en.wikipedia.org/wiki/Metropolis-adjusted_Langevin_algorithm">MALA</a> if the <code>ForwardDiff</code> and <code>DiffResults</code> packages are available. </p><p>A <code>MALA</code> sampler can be constructed by <code>MALA(proposal)</code> where <code>proposal</code> is a function that takes the gradient computed at the current sample. It is required to specify an initial sample <code>init_params</code> when calling <code>sample</code>.</p><pre><code class="language-julia hljs"># Import the package.
using AdvancedMH
using Distributions
using MCMCChains
using ForwardDiff
using StructArrays

using LinearAlgebra

# Generate a set of data from the posterior we want to estimate.
data = rand(Normal(0, 1), 30)

# Define the components of a basic model.
insupport(θ) = θ[2] &gt;= 0
dist(θ) = Normal(θ[1], θ[2])
density(θ) = insupport(θ) ? sum(logpdf.(dist(θ), data)) : -Inf

# Construct a DensityModel.
model = DensityModel(density)

# Set up the sampler with a multivariate Gaussian proposal.
σ² = 0.01
spl = MALA(x -&gt; MvNormal((σ² / 2) .* x, σ² * I))

# Sample from the posterior.
chain = sample(model, spl, 100000; init_params=ones(2), chain_type=StructArray, param_names=[&quot;μ&quot;, &quot;σ&quot;])</code></pre><h3 id="Usage-with-[LogDensityProblems.jl](https://github.com/tpapp/LogDensityProblems.jl)-2"><a class="docs-heading-anchor" href="#Usage-with-[LogDensityProblems.jl](https://github.com/tpapp/LogDensityProblems.jl)-2">Usage with <a href="https://github.com/tpapp/LogDensityProblems.jl"><code>LogDensityProblems.jl</code></a></a><a class="docs-heading-anchor-permalink" href="#Usage-with-[LogDensityProblems.jl](https://github.com/tpapp/LogDensityProblems.jl)-2" title="Permalink"></a></h3><p>As above, we can define the model with the LogDensityProblems.jl interface. We can implement the gradient of the log density function manually, or use <a href="https://github.com/tpapp/LogDensityProblemsAD.jl"><code>LogDensityProblemsAD.jl</code></a> to provide us with the gradient computation used in MALA. Using our implementation of the <code>LogDensityProblems.jl</code> interface above:</p><pre><code class="language-julia hljs">using LogDensityProblemsAD
model_with_ad = LogDensityProblemsAD.ADgradient(Val(:ForwardDiff), LogTargetDensity())
sample(model_with_ad, spl, 100000; init_params=ones(2), chain_type=StructArray, param_names=[&quot;μ&quot;, &quot;σ&quot;])</code></pre></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="api/">AdvancedMH.jl »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Thursday 26 October 2023 19:46">Thursday 26 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
